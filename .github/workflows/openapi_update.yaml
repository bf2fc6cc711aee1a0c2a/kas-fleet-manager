name: Dispatch OpenAPI Spec Change event
on:
  push:
    branches: 
      - dispatch-changes-to-oas
    # paths:
    #   - "./openapi/kas-fleet-manager.yaml"

jobs:
  dispatch:
    env:
      TOKEN: "{{ secrets.GH_CI_TOKEN }}"
    strategy:
      matrix:
        repo: ["redhat-developer/app-services-sdk-go"]
    runs-on: ubuntu-latest
    steps:
      - name: Repository Dispatch
        uses: peter-evans/repository-dispatch@v1
        with:
          token: "${{ env.TOKEN }}"
          repository: ${{ matrix.repo }}
          event-type: openapi-change
          client-payload: '{
            "github_repository": "${{ github.repository }}",
            "openapi": {
              "directory": "./openapi",
              "filename": "kas-fleet-manager.yaml"
            }
          }'